<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Project Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel="stylesheet">
    <style>
        /* ... (keep previous styles the same) ... */
    </style>
</head>
<body>
    <form id="projectForm">
        <div class="form-row">
            <!-- ... (other form inputs remain the same) ... -->
            <select class="form-input" id="newTechnician" required>
                <!-- Options will be populated dynamically -->
            </select>
            <select class="form-input" id="newStatus">
                <!-- ... (keep status options the same) ... -->
            </select>
        </div>
        <button type="button" id="addProjectBtn" onclick="addProject()">Add New Project</button>
    </form>

    <table id="projectsTable">
        <!-- ... (table headers remain the same) ... -->
        <tbody id="projectsBody">
        </tbody>
    </table>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
      const firebaseConfig = {
  apiKey: "AIzaSyAbBe90F1K_S0MO0egbX61FPeu4YM1L3uw",
  authDomain: "sealtopprojects.firebaseapp.com",
  databaseURL: "https://sealtopprojects-default-rtdb.firebaseio.com",
  projectId: "sealtopprojects",
  storageBucket: "sealtopprojects.firebasestorage.app",
  messagingSenderId: "832836984463",
  appId: "1:832836984463:web:fba3588b57ea50466f1afa"
};

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const techniciansRef = database.ref('technicians');

        // Initialize default technicians
        techniciansRef.once('value').then(snapshot => {
            if (!snapshot.exists()) {
                const defaultTechs = ['Aristeer', 'Elias', 'Wilman', 'Horlin'];
                defaultTechs.forEach(tech => techniciansRef.push().set(tech));
            }
        });

        // Track technicians list
        let techniciansList = [];
        techniciansRef.on('value', snapshot => {
            techniciansList = [];
            snapshot.forEach(child => {
                techniciansList.push(child.val());
            });
            updateTechnicianDropdowns();
        });

        function updateTechnicianDropdowns() {
            // Update form dropdown
            const formSelect = document.getElementById('newTechnician');
            formSelect.innerHTML = '';
            techniciansList.forEach(tech => {
                const option = document.createElement('option');
                option.value = tech;
                option.textContent = tech;
                formSelect.appendChild(option);
            });
            const addOption = document.createElement('option');
            addOption.value = 'add_new';
            addOption.textContent = 'Add New Technician...';
            formSelect.appendChild(addOption);

            // Update table dropdowns
            document.querySelectorAll('.tech-select').forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '';
                techniciansList.forEach(tech => {
                    const option = document.createElement('option');
                    option.value = tech;
                    option.textContent = tech;
                    option.selected = tech === currentValue;
                    select.appendChild(option);
                });
                const addOption = document.createElement('option');
                addOption.value = 'add_new';
                addOption.textContent = 'Add New Technician...';
                select.appendChild(addOption);
            });
        }

        function handleTechSelect(projectId, selectElement) {
            if (selectElement.value === 'add_new') {
                const newTech = prompt('Enter new technician name:');
                if (newTech) {
                    techniciansRef.push().set(newTech);
                    selectElement.value = newTech;
                    updateField(projectId, 'technician', newTech);
                } else {
                    selectElement.value = '';
                }
            } else {
                updateField(projectId, 'technician', selectElement.value);
            }
        }

        // Modified createProjectRow function
        function createProjectRow(project, id) {
            const row = document.createElement('tr');
            row.id = id;
            
            row.innerHTML = `
                <td>
                    <button class="move-btn" onclick="moveProject('${id}', 'up')">↑</button>
                    <button class="move-btn" onclick="moveProject('${id}', 'down')">↓</button>
                </td>
                <td><input class="editable-field" type="text" value="${project.name}" 
                      onchange="updateField('${id}', 'name', this.value)"></td>
                <td><input class="editable-field" type="date" value="${project.date}" 
                      onchange="updateField('${id}', 'date', this.value)"></td>
                <td><input class="editable-field" type="date" value="${project.dueDate}" 
                      onchange="updateField('${id}', 'dueDate', this.value)"></td>
                <td><input class="editable-field" type="text" value="${project.customer}" 
                      onchange="updateField('${id}', 'customer', this.value)"></td>
                <td><input class="editable-field" type="text" value="${project.store}" 
                      onchange="updateField('${id}', 'store', this.value)"></td>
                <td><input class="editable-field" type="text" value="${project.address}" 
                      onchange="updateField('${id}', 'address', this.value)"></td>
                <td>
                    <select class="tech-select" onchange="handleTechSelect('${id}', this)">
                        ${techniciansList.map(tech => `
                            <option ${project.technician === tech ? 'selected' : ''}>${tech}</option>
                        `).join('')}
                        <option value="add_new">Add New Technician...</option>
                    </select>
                </td>
                <td>
                    <select class="status-select" onchange="updateField('${id}', 'status', this.value)">
                        ${['Need Estimate', 'Estimate needs approval', 'Estimate Approved',
                        'Work Scheduled', 'Done', 'Paid'].map(option => 
                            `<option ${project.status === option ? 'selected' : ''}>${option}</option>`
                        ).join('')}
                    </select>
                </td>
            `;
            return row;
        }

        // ... (keep the rest of the JavaScript functions the same as previous version) ... 
    </script>
</body>
</html>
